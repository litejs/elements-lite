!function(k,j){function g(a){/[^0-9]/.test(a)&&(a='"'+a+'"');return a}function l(a){a=a.replace(/([^&\|\(\)]+)(\)?)(&|\||$)/g,function(a,b,f,c){c=f+c+c;if(~b.indexOf("*"))return'(""+i.'+b.split(".").join("\\.").split("*").join(".*").replace("=",").search(/")+"/i)>-1"+c;if(a=b.match(/^([^\[\{=]+)=?(\[|\{)([^\]\}]+)(\]|\})$/)){var e="i."+a[1];a=a[3].replace(/[^,]+/g,function(a){var b=a.split("-");if(1==b.length)return e+"=="+g(a);a=[];b[0].length&&a.push(e+">="+g(b[0]));b[1].length&&a.push(e+"<="+g(b[1]));
return"("+a.join("&&")+")"});return"("+a.split(",").join("||")+")"+c}a=b.indexOf("=");return~a?"''+i."+b.substr(0,a)+"==''+"+g(b.substr(a+1))+c:~b.indexOf(".")?g(b)+'.split(".").fold(function(a,b){return a && b in a && a[b]}, i)':g(b)+" in i"+c});0<a.length&&(this.str=a,this.test=new Function("i","return i&&"+a))}Array.from=function(a){for(var d=[],b=a.length;b--;)d[b]=a[b];return d};Array.indexFor=function(a,d,b){var f,c=0,e=a.length;if(b&&0<e&&1>b(d,a[e-1]))for(;c<e;)0>b(d,a[f=c+e>>1])?e=f:c=f+
1;return e};var h=Init.extend(j.Events,{init:function(a){this.data=a;this.previous={};this.lists=[]},set:function(a,d){var b=this.data,f=[],c;for(c in a)a.hasOwnProperty(c)&&b[c]!==a[c]&&(this.previous[c]=b[c],b[c]=a[c],f.push(c));!d&&f.length&&this.emit("change",f);return f},get:function(a){return this.data[a]}}).cache(!0,function(a){return a[0].id});h.merge=function(a,d,b,f){b=b||"";f=f||[];var c,e;for(c in d)d.hasOwnProperty(c)&&a[c]!==d[c]&&(e=d[c],f.push(b+c),null===e?delete a[c]:"object"==typeof e&&
Object.keys(e).length&&"object"==typeof a[c]?h.merge(a[c],e,b+c+".",f):a[c]=e);return f};var m=Init.extend(j.Items,j.Events,{init:function(a){this.name=a;this.items=[]},model:h,add:function(a,d){var b=a;b instanceof this.model||(b=this.model(a),b.set(a,!0));-1==b.lists.indexOf(this)&&(b.lists.push(this),d=void 0!==d?d:Array.indexFor(this.items,b,this.sortFn),this.items.splice(d,0,b),this.emit("add",b,d));return this},set:function(a,d){this.each(function(b){b.set(a,d)})},remove:function(a){-1<a.lists.remove(this)&&
this.emit("remove",a,this.items.remove(a))},removeAll:function(){for(var a=this.items.length;a--;)this.remove(this.items[a])},toString:function(){return"[List: "+this.name+"]"}}).cache(!0);l.prototype={test:True,str:"all",subset:function(a){return"all"==a.str||~this.str.indexOf(a.str)},toString:function(){return"[Filter: "+this.str+"]"}};m.Filter=l.cache(!0);k.Model=h;k.List=m}(this,Fn);
